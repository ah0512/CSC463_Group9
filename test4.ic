/*
  Project 4 - Maze Following with Fusion
   Andrew Mueller & Austin Hamman
   CSC 463 - Dr. Girard
*/


int LEFT_MOTOR = 0;
int RIGHT_MOTOR = 2;
int REFLECTIVE_RIGHT = 6;
int REFLECTIVE_LEFT = 5;
int LIGHT_SENSOR = 4;
int time = 0;
int WALL = 225;
int SOURCE = 30;

void forward(int power) {    
   motor(RIGHT_MOTOR, power);    
   motor(LEFT_MOTOR, power);
}

void backward(int power) {
   motor(RIGHT_MOTOR, -power);       
   motor(LEFT_MOTOR, -power);
}

void turnLeft(int power) {
   motor(RIGHT_MOTOR, power);    
   motor(LEFT_MOTOR, 0);
}

void turnRight(int power) {
   motor(RIGHT_MOTOR, 0);    
   motor(LEFT_MOTOR, power);   
}

void stop() {
   off(RIGHT_MOTOR);
   off(LEFT_MOTOR);
}

int checkReflective(){
  if(analog(REFLECTIVE_RIGHT) < WALL && analog(REFLECTIVE_LEFT) < WALL)
    return 1;
  else
    return 0;
}

int checkWall(){
  if(checkReflective() && analog(LIGHT_SENSOR) > SOURCE)
    return 1; //wall
  else
    return 0; //light
}

/*
void wall(){
  if(checkWall()){
    backward(70);
    sleep(0.25);
    for(time = 0; time < 20; time++){
      turnRight(100);
      sleep(0.1);
      if(checkWall()){
        turnLeft(100);
        sleep(0.35)
        break;
      }
    }
  }
}
*/

void main() {
      while(1) {
         printf("Sensor: %d %d\n", REFLECTIVE_RIGHT, LIGHT_SENSOR);
         forward(60);
         sleep(0.1);
         if(checkWall()) {
            backward(70);
            sleep(0.25);
            while(!checkWall()) {
               forward(80);
            }
            for( time = 0; time < 20; time++) {
               turnRight(100);
               sleep(0.1);
               if(checkWall()) {
                  turnLeft(100);
                  sleep(0.35);
                  break;
               }
            }
         }
      }
}
